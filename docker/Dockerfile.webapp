FROM phusion/baseimage:focal-1.0.0
LABEL maintainer="The Palace Project <info@thepalaceproject.org>"

ENV SIMPLIFIED_DB_TASK "ignore"
ENV LANG=C.UTF-8

# Copy over all Palace build files for this image
COPY ./docker /ls_build
COPY --chown=1000:1000 . /var/www/circulation

RUN /bin/bash -c "/ls_build/simplified_app.sh \
      && /ls_build/logrotate.sh \
      && /ls_build/nginx.sh \
      && /ls_build/uwsgi.sh \
      && rm -rf /ls_build && /bd_build/cleanup.sh"

VOLUME /var/log
WORKDIR /home/simplified/circulation
EXPOSE 80

CMD ["/sbin/my_init"]

# # If you launch the container interactively with `docker run -it`,
# # this is where you'll end up:
# ENTRYPOINT ["/bin/bash"]
