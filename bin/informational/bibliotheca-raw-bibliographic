#!/usr/bin/env python3
from xml.dom import minidom

from palace.api.bibliotheca import BibliothecaAPI  # noqa: E402
from palace.core.model import Collection, ExternalIntegration  # noqa: E402
from palace.core.scripts import IdentifierInputScript  # noqa: E402


class BibliothecaRawBibliographicScript(IdentifierInputScript):
    def run(self):
        args = self.parse_command_line(self._db)
        for collection in Collection.by_protocol(
            self._db, ExternalIntegration.BIBLIOTHECA
        ):
            api = BibliothecaAPI(self._db, collection)
            for identifier in args.identifiers:
                data = api.bibliographic_lookup_request([identifier.identifier])
                xml = minidom.parseString(data)
                print(xml.toprettyxml(), "\n")


BibliothecaRawBibliographicScript().run()
