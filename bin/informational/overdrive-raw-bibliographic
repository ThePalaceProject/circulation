#!/usr/bin/env python3
import json

from palace.api.overdrive import OverdriveAPI  # noqa: E402
from palace.core.model import Collection, ExternalIntegration  # noqa: E402
from palace.core.scripts import IdentifierInputScript  # noqa: E402


class OverdriveRawBibliographicScript(IdentifierInputScript):
    def run(self):
        args = self.parse_command_line(self._db)
        for collection in Collection.by_protocol(
            self._db, ExternalIntegration.OVERDRIVE
        ):
            overdrive = OverdriveAPI(self._db, collection)
            for identifier in args.identifiers:
                data = overdrive.metadata_lookup(identifier)
                print(
                    json.dumps(data, sort_keys=True, indent=4, separators=(",", ": ")),
                    "\n",
                )


OverdriveRawBibliographicScript().run()
